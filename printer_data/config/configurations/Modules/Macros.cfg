[gcode_macro CALIBRATE_Z]
description: Calibrate Z axis
gcode:
    {% set max_z = printer.toolhead.axis_maximum.z|float %}
    {% if printer.toolhead.homed_axes != "xyz" %}
      G28
    {% endif %}
    G1 X20 Y0
    G1 Z{max_z-10} F2000
    FORCE_MOVE STEPPER=stepper_z Distance=20 Velocity=10
    G1 Z{max_z-50} F2000
    G28
    
[gcode_macro BED_PID]
gcode:
    PID_CALIBRATE HEATER=heater_bed TARGET=60 TOLERANCE=0.01

[gcode_macro HOTEND_PID]
gcode:
    MPC_CALIBRATE HEATER=extruder TARGET=240 FAN_BREAKPOINTS=10

[gcode_macro Pressure_Advance_Tower]
description: Tuning tower for pressure advance tuning.
gcode:
    {% set START = params.START|default(0)|float %}
    {% set DELTA = params.DELTA|default(0.005)|float %}
    {% set HEIGHT = params.HEIGHT|default(5)|float %}
    
    TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START={START} STEP_DELTA={DELTA} STEP_HEIGHT={HEIGHT}

[gcode_macro Temperature_Tower]
description: Tuning tower for printing temperature tuning.
gcode:
    {% set START = params.START|default(240)|float %}
    {% set DELTA = params.DELTA|default(10)|float %}
    {% set HEIGHT = params.HEIGHT|default(5)|float %}
    
    TUNING_TOWER COMMAND='SET_HEATER_TEMPERATURE HEATER=extruder' PARAMETER=TARGET START={START} STEP_DELTA={DELTA} STEP_HEIGHT={HEIGHT}